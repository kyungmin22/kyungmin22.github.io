<!DOCTYPE html>
<html>
<head>
    <title>같이 수어</title>
    <!-- Font Awesome 아이콘 스타일시트 링크 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <style>
        /* 사용자 정의 팝업 스타일 */
        #customAlert {
            display: none; /* 기본적으로 숨김 */
            position: fixed; /* 고정 위치 */
            left: 50%; /* 중앙에 위치 */
            top: 50%;
            transform: translate(-50%, -50%); /* 중앙 정렬 */
            border: 1px solid #ddd;
            padding: 20px;
            background-color: white;
            z-index: 1000; /* 다른 요소 위에 표시 */
        }
    </style>
</head>
<body>
    <!-- 상단 네비게이션 바 -->
    <div style="display: flex; align-items: center">
        <!-- 뒤로가기 버튼 -->
        <button onclick="goBack()" style="font-size: 24px; margin-right: 20px">
            <i class="fas fa-home"></i>
        </button>
        <!-- 페이지 제목 -->
        <h1 style="display: inline">음성을 수어로</h1>
        <!-- 음성 인식 시작 버튼 -->
        <button onclick="startSpeechRecognition()" style="font-size: 24px; margin-left: 20px">
            <i class="fas fa-microphone"></i>
        </button>
    </div>

    <!-- 인식된 텍스트 표시 -->
    <p id="recognizedText"></p>

    <!-- 비디오 플레이어 -->
    <video id="signLanguageVideo" width="480" height="360" style="display: none" muted>
        <source id="videoSource" src="" type="video/mp4" />
        브라우저가 비디오를 지원하지 않습니다.
    </video>

    <!-- 사용자 정의 팝업 -->
    <div id="customAlert" style="text-align: center;">
        <p>수어 동영상이 없습니다.</p>
        <button onclick="closeCustomAlert()" style="margin: 0 auto;">확인</button>
    </div>

    <script>
        // 뒤로가기 함수
        function goBack() {
            window.history.back();
        }

        // 음성 인식 시작 함수
        function startSpeechRecognition() {
            var recognition = new webkitSpeechRecognition();
            recognition.lang = "ko-KR"; // 한국어로 설정
            recognition.onresult = function (event) {
                var text = event.results[0][0].transcript; // 인식된 텍스트 추출
                document.getElementById("recognizedText").innerText = text; // 텍스트 표시
                // 비디오 재생을 2초 뒤에 시작
                setTimeout(function () {
                    playVideoBasedOnText(text);
                }, 2000);
            };
            recognition.start(); // 음성 인식 시작
        }

        // 텍스트에 따른 비디오 재생 함수
        function playVideoBasedOnText(text) {
            var videoPlayer = document.getElementById("signLanguageVideo");
            var videoSource = document.getElementById("videoSource");

            // 비디오 소스 경로 업데이트
            videoSource.src = "수어 영상/" + text + ".mp4"; // '수어 영상' 폴더 안의 동영상을 참조
            videoPlayer.load();

            // 비디오 로드 에러 처리
            videoPlayer.onerror = function () {
                document.getElementById("customAlert").style.display = "block";
            };

            // 비디오 로드 완료 처리
            videoPlayer.onloadeddata = function () {
                videoPlayer.style.display = "block";
                videoPlayer.play();
                document.getElementById("recognizedText").innerText = ""; // 비디오 시작 후 텍스트 초기화
            };

            // 비디오 종료 시 처리
            videoPlayer.onended = function () {
                videoPlayer.style.display = "none"; // 비디오 종료 후 플레이어 숨김
            };
        }

        // 사용자 정의 팝업을 닫는 함수
        function closeCustomAlert() {
            document.getElementById('customAlert').style.display = 'none';
        }
    </script>
</body>
</html>
